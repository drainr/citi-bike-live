---
title: "Monthly Demand"
author: "Angelo Morelli"
format: html
execute:
  echo: false
  message: false
  warning: false
---

```{r}
#| label: setup

library(tidyverse)
library(ggplot2)
library(scales)
```

```{r}
#| cache: TRUE

june_data <- read_csv(unzip("202406-citibike-tripdata.zip"))

december_data <- read_csv(unzip("202412-citibike-tripdata.zip"))
                          
trip_data <- bind_rows(june_data, december_data)
```

```{r}
trip_data <- trip_data |>
  mutate(started_at = as.POSIXct(started_at, format = "%Y-%m-%d %H:%M:%S"))

monthly_demand <- trip_data |>
  mutate(
    month = format(started_at, "%B"),  # Extract month name (e.g., "June", "December")
    hour = as.numeric(format(started_at, "%H"))  # Extract hour as numeric (0-23)
  ) |>
  filter(month %in% c("June", "December")) |>  # Keep only June and December
  group_by(month, hour) |>
  summarise(total_trips = n(), .groups = "drop")
```

```{r}
ggplot(monthly_demand, aes(x = hour, y = total_trips, color = month)) +
  geom_line(size = 1) +  # Add line for trends
  labs(title = "Bike Demand by Hour of the Day (June vs. December)",
       x = "Hour of the Day",
       y = "Total Trips",
       color = "Month") +
  scale_x_continuous(breaks = 0:23, labels = paste0(0:23, ":00")) +  # Format x-axis labels
  scale_y_continuous(labels = unit_format(unit = "k", scale = 1e-3)) +  # Format y-axis labels as "100k", "200k", etc.
  scale_color_manual(values = c("June" = "darkblue", "December" = "darkred")) +  # Custom colors for months
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for better readability
```

```{r}
daily_demand <- trip_data |>
  mutate(
    month = format(started_at, "%B"),  # Extract month name (e.g., "June", "December")
    day_of_month = as.numeric(format(started_at, "%d"))  # Extract day of the month (1-31)
  ) |>
  filter(month %in% c("June", "December")) |>  # Keep only June and December
  group_by(month, day_of_month) |>
  summarise(total_trips = n(), .groups = "drop")
```

```{r}
ggplot(daily_demand, aes(x = day_of_month, y = total_trips, color = month)) +
  geom_line(size = 1) +  # Add line for trends
  labs(title = "Bike Demand by Day of the Month (June vs. December)",
       x = "Day of the Month",
       y = "Total Trips",
       color = "Month") +
  scale_x_continuous(breaks = 1:31, labels = 1:31) +  # Format x-axis labels for days of the month
  scale_y_continuous(labels = unit_format(unit = "k", scale = 1e-3)) +  # Format y-axis labels as "100k", "200k", etc.
  scale_color_manual(values = c("June" = "darkblue", "December" = "darkred")) +# Custom colors for months
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Rotate x-axis labels for better readability
```

